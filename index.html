<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>人数換算：調味料</title>

<style>
:root { --w: 560px; }
body {
  font-family: system-ui, -apple-system, "Hiragino Kaku Gothic ProN", "Noto Sans JP", sans-serif;
  margin: 18px; line-height: 1.6;
}
h1 { font-size: 20px; margin-bottom: 12px; }

.card {
  max-width: var(--w);
  border: 1px solid #ddd;
  border-radius: 14px;
  padding: 14px;
  margin-bottom: 14px;
}

.row { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
.row3 { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 12px; }

label { font-weight: 650; display: block; margin-bottom: 6px; }

select {
  font-size: 16px;
  padding: 8px;
  border-radius: 10px;
  border: 1px solid #ccc;
  box-sizing: border-box;
  width: 100%;
}

.number-control {
  display: flex;
  align-items: center;
  gap: 6px;
}
.number-control input {
  width: 70px;
  text-align: right;
  font-size: 16px;
  padding: 8px;
  border-radius: 10px;
  border: 1px solid #ccc;
  box-sizing: border-box;
}
.number-control button {
  width: 34px;
  height: 34px;
  font-size: 18px;
  border-radius: 8px;
  border: 1px solid #ccc;
  background: #f5f5f5;
}
.number-control button:active { transform: translateY(1px); }
.number-control span.unit {
  margin-left: 4px;
  white-space: nowrap;
}

.hr { height: 1px; background: #eee; margin: 12px 0; }

/* 調味料ヘッダー（選択＋リセット） */
.condiment-head{
  display: flex;
  align-items: end;
  gap: 10px;
}
.condiment-head .grow { flex: 1; }
.reset-btn{
  white-space: nowrap;
  font-size: 14px;
  padding: 9px 12px;
  border-radius: 10px;
  border: 1px solid #ccc;
  background: #f7f7f7;
}
.reset-btn:active{ transform: translateY(1px); }

/* 結果表示 */
.result { font-size: 1.5em; }
.result-row {
  display: flex;
  justify-content: space-between;
  gap: 6px;
}
.result-item { flex: 1; }
.result b { font-size: 1.2em; }
.mono { font-variant-numeric: tabular-nums; }

@media (max-width:520px){
  .row, .row3 { grid-template-columns: 1fr; }
  .result-row { flex-direction: column; }
  .condiment-head { align-items: stretch; }
}
</style>
</head>

<body>
<h1>人数換算：調味料</h1>

<div class="card">
  <div class="row">
    <div>
      <label>レシピは何人分？</label>
      <div class="number-control">
        <button class="btn-step" data-target="recipeServings" data-delta="-1" type="button">−</button>
        <input id="recipeServings" type="number" value="1" readonly>
        <button class="btn-step" data-target="recipeServings" data-delta="1" type="button">＋</button>
        <span class="unit">人分</span>
      </div>
    </div>

    <div>
      <label>作りたいのは何人分？</label>
      <div class="number-control">
        <button class="btn-step" data-target="targetServings" data-delta="-1" type="button">−</button>
        <input id="targetServings" type="number" value="1" readonly>
        <button class="btn-step" data-target="targetServings" data-delta="1" type="button">＋</button>
        <span class="unit">人分</span>
      </div>
    </div>
  </div>
</div>

<div class="card">
  <div class="condiment-head">
    <div class="grow">
      <label>調味料</label>
      <select id="condiment"></select>
    </div>
    <div>
      <label>&nbsp;</label>
      <button id="btnReset" class="reset-btn" type="button">リセット</button>
    </div>
  </div>

  <div class="hr"></div>

  <div class="row3">
    <div>
      <label>大さじ</label>
      <div class="number-control">
        <button class="btn-step" data-target="tbsp" data-delta="-1" type="button">−</button>
        <input id="tbsp" type="number" value="0" readonly>
        <button class="btn-step" data-target="tbsp" data-delta="1" type="button">＋</button>
        <span class="unit">杯</span>
      </div>
    </div>

    <div>
      <label>大さじ1/2</label>
      <div class="number-control">
        <button class="btn-step" data-target="tbspHalf" data-delta="-1" type="button">−</button>
        <input id="tbspHalf" type="number" value="0" readonly>
        <button class="btn-step" data-target="tbspHalf" data-delta="1" type="button">＋</button>
        <span class="unit">杯</span>
      </div>
    </div>
  </div>

  <div class="row3" style="margin-top:10px;">
    <div>
      <label>小さじ1</label>
      <div class="number-control">
        <button class="btn-step" data-target="tsp" data-delta="-1" type="button">−</button>
        <input id="tsp" type="number" value="0" readonly>
        <button class="btn-step" data-target="tsp" data-delta="1" type="button">＋</button>
        <span class="unit">杯</span>
      </div>
    </div>

    <div>
      <label>小さじ1/2</label>
      <div class="number-control">
        <button class="btn-step" data-target="tspHalf" data-delta="-1" type="button">−</button>
        <input id="tspHalf" type="number" value="0" readonly>
        <button class="btn-step" data-target="tspHalf" data-delta="1" type="button">＋</button>
        <span class="unit">杯</span>
      </div>
    </div>

    <div>
      <label>小さじ1/4</label>
      <div class="number-control">
        <button class="btn-step" data-target="tspQuarter" data-delta="-1" type="button">−</button>
        <input id="tspQuarter" type="number" value="0" readonly>
        <button class="btn-step" data-target="tspQuarter" data-delta="1" type="button">＋</button>
        <span class="unit">杯</span>
      </div>
    </div>
  </div>

  <div class="hr"></div>

  <div class="result mono">
    <div class="result-row">
      <div class="result-item">計量：<b id="outMeasure">0</b></div>
      <div class="result-item"></div>
    </div>
    <div class="result-row">
      <div class="result-item">容量：<b id="outCc">0</b> cc</div>
      <div class="result-item">重さ：約 <b id="outG">0</b> g</div>
    </div>
  </div>
</div>

<script>
const DENSITY = {
  "水":100,
  "しょうゆ":120,
  "調理酒":100,
  "みりん":120,
  "砂糖":65,
  "ケチャップ":140,
  "ソース":120
};

const CC = {
  tbsp: 15,
  tbspHalf: 7.5,
  tsp: 5,
  tspHalf: 2.5,
  tspQuarter: 1.25
};

const $ = id => document.getElementById(id);

Object.keys(DENSITY).forEach(k=>{
  const o=document.createElement("option");
  o.value=k; o.textContent=k;
  $("condiment").appendChild(o);
});

function round1(n){ return Math.round(n*10)/10; }

function setZeroMeasures(){
  $("tbsp").value = 0;
  $("tbspHalf").value = 0;
  $("tsp").value = 0;
  $("tspHalf").value = 0;
  $("tspQuarter").value = 0;
}

function applyStep(id, delta){
  const el = $(id);
  const min = (id === "recipeServings" || id === "targetServings") ? 1 : 0;
  el.value = Math.max(min, Number(el.value) + delta);
  calc();
}

/**
 * 完成版：cc → 表示文字列
 *
 * 表示ポリシー：
 * 1) 大さじ入力（tbsp / tbspHalf）がある場合：
 *    - 12Q未満でも「大さじ1/2」を表示してよい（例：大さじ1/2 1杯 → 大さじ 1/2）
 * 2) 大さじ入力がない場合：
 *    - 大さじ1未満（12Q未満）は小さじで表示（例：小さじ1/2×3(=6Q) → 小さじ1 小さじ1/2）
 * 3) 小さじ側は必ず繰り上げ完了（1/4→1/2→1）
 * 4) 小さじ3 → 大さじ1 へ繰り上げ
 * 5) 分数はNBSPで改行防止
 */
function measureTextFromCc(totalCc, preferTbspUnder1){
  const NBSP = "\u00A0";
  const qUnit = CC.tspQuarter; // 1.25cc
  const totalQ = Math.max(0, Math.round(totalCc / qUnit)); // 小さじ1/4単位（整数）

  let q = totalQ;

  let tbsp = 0;
  let tbspHalf = 0;

  const allowTbsp = (q >= 12) || !!preferTbspUnder1;

  if (allowTbsp) {
    tbsp = Math.floor(q / 12);
    q %= 12;

    // 大さじは「1/2」まで（1/4は作らない）
    tbspHalf = Math.floor(q / 6); // 0..1
    q %= 6;
  }

  // 残りを小さじへ（整数/1/2/1/4）
  let tsp = Math.floor(q / 4);
  q %= 4;

  let tspHalf = Math.floor(q / 2);
  q %= 2;

  let tspQuarter = q; // 0..1

  // 小さじ側の繰り上げ（同一単位内）
  if (tspQuarter >= 2) {
    tspHalf += Math.floor(tspQuarter / 2);
    tspQuarter %= 2;
  }
  if (tspHalf >= 2) {
    tsp += Math.floor(tspHalf / 2);
    tspHalf %= 2;
  }

  // 小さじ3 → 大さじ1 へ繰り上げ
  let tspQ = tsp * 4 + tspHalf * 2 + tspQuarter;
  if (tspQ >= 12) {
    const carry = Math.floor(tspQ / 12);
    tbsp += carry;
    tspQ %= 12;

    tsp = Math.floor(tspQ / 4); tspQ %= 4;
    tspHalf = Math.floor(tspQ / 2); tspQ %= 2;
    tspQuarter = tspQ;
  }

  const parts = [];
  if (tbsp) parts.push(`大さじ${tbsp}`);
  if (tbspHalf) parts.push(`大さじ${NBSP}1/2`);

  if (tsp) parts.push(`小さじ${tsp}`);
  if (tspHalf) parts.push(`小さじ${NBSP}1/2`);
  if (tspQuarter) parts.push(`小さじ${NBSP}1/4`);

  return parts.length ? parts.join("　") : "0";
}

function calc(){
  const recipe = Math.max(1, Number($("recipeServings").value));
  const target = Math.max(1, Number($("targetServings").value));
  const factor = target / recipe;

  const baseCc =
    Number($("tbsp").value)       * CC.tbsp +
    Number($("tbspHalf").value)   * CC.tbspHalf +
    Number($("tsp").value)        * CC.tsp +
    Number($("tspHalf").value)    * CC.tspHalf +
    Number($("tspQuarter").value) * CC.tspQuarter;

  const totalCc = baseCc * factor;

  // 大さじ入力があるなら、大さじ1未満でも大さじ1/2表記を許可
  const preferTbspUnder1 =
    Number($("tbsp").value) > 0 || Number($("tbspHalf").value) > 0;

  $("outMeasure").textContent = measureTextFromCc(totalCc, preferTbspUnder1);
  $("outCc").textContent = round1(totalCc);
  $("outG").textContent  = round1(totalCc * DENSITY[$("condiment").value] / 100);
}

// ±ボタン
document.querySelectorAll(".btn-step").forEach(btn=>{
  btn.addEventListener("click", ()=>{
    applyStep(btn.dataset.target, Number(btn.dataset.delta));
  });
});

// リセット（調味料の杯数だけ）
$("btnReset").addEventListener("click", ()=>{
  setZeroMeasures();
  calc();
});

// 調味料を選び直したら自動リセット
$("condiment").addEventListener("change", ()=>{
  setZeroMeasures();
  calc();
});

$("condiment").value="水";
setZeroMeasures();
calc();
</script>
</body>
</html>
